---
phase: 02-layout-navigation
plan: 05
type: execute
wave: 2
depends_on: [02-01]
files_modified: [src/components/layout/MobileNav/MobileNavContext.tsx, src/components/layout/MobileNav/MobileNavProvider.tsx]
autonomous: true

must_haves:
  truths:
    - "MobileNavContext provides type definition for active section and progress"
    - "MobileNavProvider tracks active section using IntersectionObserver"
    - "MobileNavProvider calculates section scroll progress"
  artifacts:
    - path: "src/components/layout/MobileNav/MobileNavContext.tsx"
      provides: "Context for active section tracking"
      contains: "createContext"
    - path: "src/components/layout/MobileNav/MobileNavProvider.tsx"
      provides: "Active section state provider"
      exports: ["MobileNavProvider", "useMobileNavContext"]
  key_links:
    - from: "src/components/layout/MobileNav/MobileNavProvider.tsx"
      to: "IntersectionObserver"
      via: "active section detection"
      pattern: "IntersectionObserver"
---

<objective>
Create the MobileNav context and provider foundation for tracking active section and scroll progress.

Purpose: Establishes the state management layer for mobile navigation. The context/provider pattern allows active section tracking via IntersectionObserver and scroll progress calculation, which will be consumed by the MobileNav UI component in the next plan.

Output: MobileNavContext type definition and MobileNavProvider with active section tracking and scroll progress calculation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/02-layout-navigation/02-CONTEXT.md
@.planning/phases/02-layout-navigation/02-RESEARCH.md
@.planning/phases/02-layout-navigation/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create MobileNavContext.tsx</name>
  <files>src/components/layout/MobileNav/MobileNavContext.tsx</files>
  <action>
    Create context definition for mobile navigation state:

    import { createContext } from "react";

    type MobileNavContextValue = {
      activeSection: string;
      sectionProgress: number;
    };

    export const MobileNavContext = createContext<MobileNavContextValue | null>(null);

    Follow CLAUDE.md pattern: Context.tsx contains ONLY type definition and createContext export.
  </action>
  <verify>file exists and exports MobileNavContext</verify>
  <done>MobileNavContext type definition created</done>
</task>

<task type="auto">
  <name>Create MobileNavProvider.tsx</name>
  <files>src/components/layout/MobileNav/MobileNavProvider.tsx</files>
  <action>
    Create provider that tracks active section and progress using Intersection Observer:

    import { createContext, useContext, useEffect, useState } from "react";
    import type { MobileNavContextValue } from "./MobileNavContext";
    import { MobileNavContext } from "./MobileNavContext";

    type MobileNavProviderProps = {
      children: React.ReactNode;
    };

    const sections = ["about", "career", "skills", "projects", "contact"];

    export const MobileNavProvider = ({ children }: MobileNavProviderProps) => {
      const [activeSection, setActiveSection] = useState("about");
      const [sectionProgress, setSectionProgress] = useState(0);

      useEffect(() => {
        const observers = sections.map((sectionId) => {
          const element = document.getElementById(sectionId);
          if (!element) return null;

          return new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  setActiveSection(sectionId);
                }
              });
            },
            { threshold: 0.3 }
          );
        });

        const validObservers = observers.filter(Boolean) as IntersectionObserver[];

        validObservers.forEach((observer, index) => {
          const element = document.getElementById(sections[index]!);
          if (element) observer.observe(element);
        });

        const handleScroll = () => {
          const activeElement = document.getElementById(activeSection);
          if (!activeElement) return;

          const rect = activeElement.getBoundingClientRect();
          const sectionHeight = activeElement.offsetHeight;
          const scrolled = -rect.top;
          const progress = Math.min(Math.max(scrolled / sectionHeight, 0), 1);
          setSectionProgress(progress);
        };

        window.addEventListener("scroll", handleScroll);

        return () => {
          validObservers.forEach((observer) => observer.disconnect());
          window.removeEventListener("scroll", handleScroll);
        };
      }, [activeSection]);

      const value: MobileNavContextValue = { activeSection, sectionProgress };

      return (
        <MobileNavContext.Provider value={value}>
          {children}
        </MobileNavContext.Provider>
      );
    };

    export const useMobileNavContext = (): MobileNavContextValue => {
      const context = useContext(MobileNavContext);
      if (!context) throw new Error("MobileNav parts must be used within MobileNav");
      return context;
    };
  </action>
  <verify>file exists and exports MobileNavProvider and useMobileNavContext</verify>
  <done>MobileNavProvider with active section tracking created</done>
</task>

</tasks>

<verification>
- MobileNavContext.tsx exists and exports createContext with MobileNavContextValue type
- MobileNavProvider.tsx exists and exports MobileNavProvider and useMobileNavContext hook
- useMobileNavContext throws error when used outside provider
- Provider tracks activeSection state with "about" as default
- Provider tracks sectionProgress state (0-1 range)
- IntersectionObserver configured with 0.3 threshold
- Scroll handler calculates progress based on active section position
</verification>

<success_criteria>
MobileNav context and provider foundation created with active section tracking via IntersectionObserver and scroll progress calculation. Ready for MobileNav UI component to consume this state.
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-navigation/02-05-SUMMARY.md`
</output>
